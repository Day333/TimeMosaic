Using GPU
Args in experiment:
[1mBasic Config[0m
  Task Name:          AGPT_loss           Is Training:        1                   
  Model ID:           weather_96_96       Model:              AGPT_PT             

[1mData Loader[0m
  Data:               custom              Root Path:          ./dataset/weather/  
  Data Path:          weather.csv         Features:           M                   
  Target:             OT                  Freq:               h                   
  Checkpoints:        ./checkpoints/      

[1mModel Parameters[0m
  Num Kernels:        6                   
  Enc In:             21                  Dec In:             21                  
  C Out:              21                  d model:            512                 
  n heads:            4                   e layers:           2                   
  d layers:           1                   d FF:               2048                
  Moving Avg:         25                  Factor:             3                   
  Distil:             1                   Dropout:            0.1                 
  Embed:              timeF               Activation:         gelu                

[1mRun Parameters[0m
  Num Workers:        10                  Itr:                1                   
  Train Epochs:       10                  Batch Size:         32                  
  Patience:           3                   Learning Rate:      0.0001              
  Des:                Exp                 Loss:               MSE                 
  Lradj:              type1               Use Amp:            0                   

[1mGPU[0m
  Use GPU:            1                   GPU:                0                   
  Use Multi GPU:      0                   Devices:            0,1,2,3             

[1mDe-stationary Projector Params[0m
  P Hidden Dims:      128, 128            P Hidden Layers:    2                   

Use GPU: cuda:0
>>>>>>>start training : AGPT_loss_weather_96_96_AGPT_PT_2048_fixedFalse_0.0001_0.001>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36696
val 5175
test 10444
	iters: 100, epoch: 1 | loss: 0.4771556
	speed: 0.4231s/iter; left time: 4811.4345s
	iters: 200, epoch: 1 | loss: 0.4275452
	speed: 0.4182s/iter; left time: 4713.9324s
	iters: 300, epoch: 1 | loss: 0.8343711
	speed: 0.4181s/iter; left time: 4670.8395s
	iters: 400, epoch: 1 | loss: 0.3668149
	speed: 0.4186s/iter; left time: 4634.5195s
	iters: 500, epoch: 1 | loss: 0.5780714
	speed: 0.4183s/iter; left time: 4588.7024s
	iters: 600, epoch: 1 | loss: 0.3578613
	speed: 0.4167s/iter; left time: 4530.0822s
	iters: 700, epoch: 1 | loss: 0.4841776
	speed: 0.4191s/iter; left time: 4514.2064s
	iters: 800, epoch: 1 | loss: 0.3462479
	speed: 0.4180s/iter; left time: 4460.8417s
	iters: 900, epoch: 1 | loss: 0.5122660
	speed: 0.4164s/iter; left time: 4401.7401s
	iters: 1000, epoch: 1 | loss: 0.4972837
	speed: 0.4185s/iter; left time: 4382.0717s
	iters: 1100, epoch: 1 | loss: 0.4149974
	speed: 0.4157s/iter; left time: 4311.4402s
Epoch: 1 cost time: 479.18365359306335
Epoch: 1, Steps: 1147 | Train Loss: 0.5185526 Vali Loss: 0.4491663 Test Loss: 0.1834298
Validation loss decreased (inf --> 0.449166).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.4189364
	speed: 1.4049s/iter; left time: 14363.7542s
	iters: 200, epoch: 2 | loss: 0.4588795
	speed: 0.4094s/iter; left time: 4144.5774s
	iters: 300, epoch: 2 | loss: 0.5075490
	speed: 0.4085s/iter; left time: 4094.9897s
	iters: 400, epoch: 2 | loss: 0.2543139
	speed: 0.4078s/iter; left time: 4046.8729s
	iters: 500, epoch: 2 | loss: 0.5863382
	speed: 0.4104s/iter; left time: 4032.0061s
	iters: 600, epoch: 2 | loss: 0.3599407
	speed: 0.4093s/iter; left time: 3979.7931s
	iters: 700, epoch: 2 | loss: 0.3454334
	speed: 0.4085s/iter; left time: 3931.3549s
	iters: 800, epoch: 2 | loss: 0.5260743
	speed: 0.4132s/iter; left time: 3935.0831s
	iters: 900, epoch: 2 | loss: 0.4043043
	speed: 0.4192s/iter; left time: 3950.6313s
	iters: 1000, epoch: 2 | loss: 1.3062563
	speed: 0.4191s/iter; left time: 3908.1383s
	iters: 1100, epoch: 2 | loss: 0.4702197
	speed: 0.4190s/iter; left time: 3864.4053s
Epoch: 2 cost time: 472.8099446296692
Epoch: 2, Steps: 1147 | Train Loss: 0.4915880 Vali Loss: 0.4525927 Test Loss: 0.1862642
EarlyStopping counter: 1 out of 3
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.3298836
	speed: 1.4254s/iter; left time: 12938.7413s
	iters: 200, epoch: 3 | loss: 0.3648543
	speed: 0.4191s/iter; left time: 3762.0843s
	iters: 300, epoch: 3 | loss: 0.3288492
	speed: 0.4185s/iter; left time: 3714.8248s
	iters: 400, epoch: 3 | loss: 0.4573903
	speed: 0.4191s/iter; left time: 3678.5577s
	iters: 500, epoch: 3 | loss: 0.3446661
	speed: 0.4211s/iter; left time: 3653.5684s
	iters: 600, epoch: 3 | loss: 0.4019486
	speed: 0.4203s/iter; left time: 3605.0966s
	iters: 700, epoch: 3 | loss: 0.4145495
	speed: 0.4202s/iter; left time: 3562.3084s
	iters: 800, epoch: 3 | loss: 0.5431476
	speed: 0.4202s/iter; left time: 3520.2857s
	iters: 900, epoch: 3 | loss: 0.6451328
	speed: 0.4201s/iter; left time: 3477.5015s
	iters: 1000, epoch: 3 | loss: 1.1964904
	speed: 0.4209s/iter; left time: 3441.9401s
	iters: 1100, epoch: 3 | loss: 0.4794361
	speed: 0.4188s/iter; left time: 3382.7241s
Epoch: 3 cost time: 481.6437487602234
Epoch: 3, Steps: 1147 | Train Loss: 0.4793506 Vali Loss: 0.4429964 Test Loss: 0.1764154
Validation loss decreased (0.449166 --> 0.442996).  Saving model ...
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.3819429
	speed: 1.4319s/iter; left time: 11355.3221s
	iters: 200, epoch: 4 | loss: 0.4191528
	speed: 0.4199s/iter; left time: 3287.8357s
	iters: 300, epoch: 4 | loss: 0.3212450
	speed: 0.4194s/iter; left time: 3241.7778s
	iters: 400, epoch: 4 | loss: 0.3965060
	speed: 0.4190s/iter; left time: 3196.7356s
	iters: 500, epoch: 4 | loss: 0.4891858
	speed: 0.4206s/iter; left time: 3167.1798s
	iters: 600, epoch: 4 | loss: 0.4696473
	speed: 0.4206s/iter; left time: 3124.7712s
	iters: 700, epoch: 4 | loss: 0.2714643
	speed: 0.4199s/iter; left time: 3077.5026s
	iters: 800, epoch: 4 | loss: 1.2156441
	speed: 0.4198s/iter; left time: 3034.9924s
	iters: 900, epoch: 4 | loss: 0.4032076
	speed: 0.4205s/iter; left time: 2997.8343s
	iters: 1000, epoch: 4 | loss: 0.4053563
	speed: 0.4195s/iter; left time: 2949.3608s
	iters: 1100, epoch: 4 | loss: 0.3260416
	speed: 0.4122s/iter; left time: 2856.8883s
Epoch: 4 cost time: 479.8370690345764
Epoch: 4, Steps: 1147 | Train Loss: 0.4714817 Vali Loss: 0.4492803 Test Loss: 0.1788626
EarlyStopping counter: 1 out of 3
Updating learning rate to 1.25e-05
	iters: 100, epoch: 5 | loss: 0.4226590
	speed: 1.3987s/iter; left time: 9487.6624s
	iters: 200, epoch: 5 | loss: 0.4818191
	speed: 0.3546s/iter; left time: 2370.0435s
	iters: 300, epoch: 5 | loss: 1.3451377
	speed: 0.3765s/iter; left time: 2478.2079s
	iters: 400, epoch: 5 | loss: 0.3450210
	speed: 0.3799s/iter; left time: 2463.1279s
	iters: 500, epoch: 5 | loss: 0.2859007
	speed: 0.3911s/iter; left time: 2496.5379s
	iters: 600, epoch: 5 | loss: 0.3720465
	speed: 0.3919s/iter; left time: 2462.4039s
	iters: 700, epoch: 5 | loss: 1.2744814
	speed: 0.3894s/iter; left time: 2407.7766s
	iters: 800, epoch: 5 | loss: 0.4724827
	speed: 0.3911s/iter; left time: 2379.2764s
	iters: 900, epoch: 5 | loss: 0.3738039
	speed: 0.3895s/iter; left time: 2330.5436s
	iters: 1000, epoch: 5 | loss: 0.4874916
	speed: 0.3913s/iter; left time: 2301.7869s
	iters: 1100, epoch: 5 | loss: 0.2670276
	speed: 0.3672s/iter; left time: 2123.6949s
Epoch: 5 cost time: 437.7851228713989
Epoch: 5, Steps: 1147 | Train Loss: 0.4678475 Vali Loss: 0.4428910 Test Loss: 0.1764854
Validation loss decreased (0.442996 --> 0.442891).  Saving model ...
Updating learning rate to 6.25e-06
	iters: 100, epoch: 6 | loss: 0.4084189
	speed: 1.3079s/iter; left time: 7371.2754s
	iters: 200, epoch: 6 | loss: 0.3823907
	speed: 0.3911s/iter; left time: 2165.1965s
	iters: 300, epoch: 6 | loss: 0.2823645
	speed: 0.3912s/iter; left time: 2126.5110s
	iters: 400, epoch: 6 | loss: 0.2545157
	speed: 0.3911s/iter; left time: 2086.9008s
	iters: 500, epoch: 6 | loss: 0.4896143
	speed: 0.3912s/iter; left time: 2048.4607s
	iters: 600, epoch: 6 | loss: 0.4687131
	speed: 0.3893s/iter; left time: 1999.3524s
	iters: 700, epoch: 6 | loss: 0.3469412
	speed: 0.3911s/iter; left time: 1969.3870s
	iters: 800, epoch: 6 | loss: 0.3265119
	speed: 0.3700s/iter; left time: 1826.0996s
	iters: 900, epoch: 6 | loss: 1.2576116
	speed: 0.3592s/iter; left time: 1736.8872s
	iters: 1000, epoch: 6 | loss: 0.5618051
	speed: 0.3619s/iter; left time: 1714.0007s
	iters: 1100, epoch: 6 | loss: 0.4146473
	speed: 0.3909s/iter; left time: 1812.1980s
Epoch: 6 cost time: 440.1710364818573
Epoch: 6, Steps: 1147 | Train Loss: 0.4660792 Vali Loss: 0.4421370 Test Loss: 0.1748395
Validation loss decreased (0.442891 --> 0.442137).  Saving model ...
Updating learning rate to 3.125e-06
	iters: 100, epoch: 7 | loss: 0.4620918
	speed: 1.3580s/iter; left time: 6096.0490s
	iters: 200, epoch: 7 | loss: 1.2625550
	speed: 0.3903s/iter; left time: 1713.1426s
	iters: 300, epoch: 7 | loss: 0.5736014
	speed: 0.3912s/iter; left time: 1677.9905s
	iters: 400, epoch: 7 | loss: 0.3224776
	speed: 0.3914s/iter; left time: 1639.6827s
	iters: 500, epoch: 7 | loss: 0.5571676
	speed: 0.3722s/iter; left time: 1521.9095s
	iters: 600, epoch: 7 | loss: 0.3404897
	speed: 0.3588s/iter; left time: 1431.1608s
	iters: 700, epoch: 7 | loss: 0.3591862
	speed: 0.3547s/iter; left time: 1379.5451s
	iters: 800, epoch: 7 | loss: 0.2820461
	speed: 0.3789s/iter; left time: 1435.8191s
	iters: 900, epoch: 7 | loss: 1.3073922
	speed: 0.3775s/iter; left time: 1392.7128s
	iters: 1000, epoch: 7 | loss: 0.3226077
	speed: 0.3800s/iter; left time: 1363.9777s
	iters: 1100, epoch: 7 | loss: 0.5263018
	speed: 0.3768s/iter; left time: 1314.7437s
Epoch: 7 cost time: 434.0854892730713
Epoch: 7, Steps: 1147 | Train Loss: 0.4651756 Vali Loss: 0.4407314 Test Loss: 0.1743122
Validation loss decreased (0.442137 --> 0.440731).  Saving model ...
Updating learning rate to 1.5625e-06
	iters: 100, epoch: 8 | loss: 0.5421277
	speed: 1.3414s/iter; left time: 4482.8083s
	iters: 200, epoch: 8 | loss: 0.3189754
	speed: 0.3746s/iter; left time: 1214.5950s
	iters: 300, epoch: 8 | loss: 0.5005012
	speed: 0.3564s/iter; left time: 1119.8300s
	iters: 400, epoch: 8 | loss: 0.5881184
	speed: 0.3562s/iter; left time: 1083.4953s
	iters: 500, epoch: 8 | loss: 0.4776315
	speed: 0.3873s/iter; left time: 1139.5296s
	iters: 600, epoch: 8 | loss: 0.2541483
	speed: 0.3916s/iter; left time: 1112.8307s
	iters: 700, epoch: 8 | loss: 0.3692605
	speed: 0.3923s/iter; left time: 1075.7252s
	iters: 800, epoch: 8 | loss: 0.5215651
	speed: 0.3903s/iter; left time: 1031.2201s
	iters: 900, epoch: 8 | loss: 0.3565602
	speed: 0.3917s/iter; left time: 995.7617s
	iters: 1000, epoch: 8 | loss: 0.3152911
	speed: 0.3925s/iter; left time: 958.4302s
	iters: 1100, epoch: 8 | loss: 0.2302971
	speed: 0.3905s/iter; left time: 914.5770s
Epoch: 8 cost time: 438.8060779571533
Epoch: 8, Steps: 1147 | Train Loss: 0.4645411 Vali Loss: 0.4403051 Test Loss: 0.1742870
Validation loss decreased (0.440731 --> 0.440305).  Saving model ...
Updating learning rate to 7.8125e-07
	iters: 100, epoch: 9 | loss: 0.2920967
	speed: 1.2945s/iter; left time: 2841.4959s
	iters: 200, epoch: 9 | loss: 0.2828547
	speed: 0.3811s/iter; left time: 798.4994s
	iters: 300, epoch: 9 | loss: 0.4021905
	speed: 0.3915s/iter; left time: 780.9659s
	iters: 400, epoch: 9 | loss: 0.3806198
	speed: 0.3901s/iter; left time: 739.1598s
	iters: 500, epoch: 9 | loss: 0.3963012
	speed: 0.3906s/iter; left time: 701.1539s
	iters: 600, epoch: 9 | loss: 0.2705812
	speed: 0.3893s/iter; left time: 659.8345s
	iters: 700, epoch: 9 | loss: 0.3863140
	speed: 0.3912s/iter; left time: 623.9301s
	iters: 800, epoch: 9 | loss: 0.3417272
	speed: 0.3904s/iter; left time: 583.6689s
	iters: 900, epoch: 9 | loss: 0.3822456
	speed: 0.3904s/iter; left time: 544.5727s
	iters: 1000, epoch: 9 | loss: 0.3969867
	speed: 0.3761s/iter; left time: 487.0995s
	iters: 1100, epoch: 9 | loss: 0.5691903
	speed: 0.3598s/iter; left time: 429.9268s
Epoch: 9 cost time: 438.06367206573486
Epoch: 9, Steps: 1147 | Train Loss: 0.4643108 Vali Loss: 0.4411315 Test Loss: 0.1745469
EarlyStopping counter: 1 out of 3
Updating learning rate to 3.90625e-07
	iters: 100, epoch: 10 | loss: 0.4033731
	speed: 1.3297s/iter; left time: 1393.5423s
	iters: 200, epoch: 10 | loss: 0.3459905
	speed: 0.3910s/iter; left time: 370.6592s
	iters: 300, epoch: 10 | loss: 0.3074458
	speed: 0.3898s/iter; left time: 330.5705s
	iters: 400, epoch: 10 | loss: 0.3146598
	speed: 0.3803s/iter; left time: 284.4353s
	iters: 500, epoch: 10 | loss: 0.3682069
	speed: 0.3780s/iter; left time: 244.9570s
	iters: 600, epoch: 10 | loss: 0.3125202
	speed: 0.3799s/iter; left time: 208.2059s
	iters: 700, epoch: 10 | loss: 0.4555404
	speed: 0.3617s/iter; left time: 162.0217s
	iters: 800, epoch: 10 | loss: 0.5097985
	speed: 0.3462s/iter; left time: 120.4910s
	iters: 900, epoch: 10 | loss: 0.3339074
	speed: 0.3462s/iter; left time: 85.8559s
	iters: 1000, epoch: 10 | loss: 0.4294629
	speed: 0.3369s/iter; left time: 49.8578s
	iters: 1100, epoch: 10 | loss: 0.3626003
	speed: 0.3172s/iter; left time: 15.2260s
Epoch: 10 cost time: 414.5879855155945
Epoch: 10, Steps: 1147 | Train Loss: 0.4640101 Vali Loss: 0.4410868 Test Loss: 0.1749047
EarlyStopping counter: 2 out of 3
Updating learning rate to 1.953125e-07
>>>>>>>testing : AGPT_loss_weather_96_96_AGPT_PT_2048_fixedFalse_0.0001_0.001<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10444
test shape: (10444, 96, 21) (10444, 96, 21)
test shape: (10444, 96, 21) (10444, 96, 21)
mse:0.17454037070274353, mae:0.21416880190372467
Using GPU
Args in experiment:
[1mBasic Config[0m
  Task Name:          AGPT_loss           Is Training:        1                   
  Model ID:           weather_96_192      Model:              AGPT_PT             

[1mData Loader[0m
  Data:               custom              Root Path:          ./dataset/weather/  
  Data Path:          weather.csv         Features:           M                   
  Target:             OT                  Freq:               h                   
  Checkpoints:        ./checkpoints/      

[1mModel Parameters[0m
  Num Kernels:        6                   
  Enc In:             21                  Dec In:             21                  
  C Out:              21                  d model:            512                 
  n heads:            16                  e layers:           2                   
  d layers:           1                   d FF:               2048                
  Moving Avg:         25                  Factor:             3                   
  Distil:             1                   Dropout:            0.1                 
  Embed:              timeF               Activation:         gelu                

[1mRun Parameters[0m
  Num Workers:        10                  Itr:                1                   
  Train Epochs:       10                  Batch Size:         32                  
  Patience:           3                   Learning Rate:      0.0001              
  Des:                Exp                 Loss:               MSE                 
  Lradj:              type1               Use Amp:            0                   

[1mGPU[0m
  Use GPU:            1                   GPU:                0                   
  Use Multi GPU:      0                   Devices:            0,1,2,3             

[1mDe-stationary Projector Params[0m
  P Hidden Dims:      128, 128            P Hidden Layers:    2                   

Use GPU: cuda:0
>>>>>>>start training : AGPT_loss_weather_96_192_AGPT_PT_2048_fixedFalse_0.0001_0.001>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36600
val 5079
test 10348
	iters: 100, epoch: 1 | loss: 0.4580811
	speed: 0.5314s/iter; left time: 6027.1706s
	iters: 200, epoch: 1 | loss: 1.3904474
	speed: 0.5302s/iter; left time: 5959.5641s
	iters: 300, epoch: 1 | loss: 1.0306104
	speed: 0.5295s/iter; left time: 5899.7040s
	iters: 400, epoch: 1 | loss: 0.9217155
	speed: 0.5312s/iter; left time: 5864.7959s
	iters: 500, epoch: 1 | loss: 0.4815383
	speed: 0.5292s/iter; left time: 5790.0648s
	iters: 600, epoch: 1 | loss: 0.4148507
	speed: 0.5301s/iter; left time: 5746.8969s
	iters: 700, epoch: 1 | loss: 0.4056490
	speed: 0.5295s/iter; left time: 5687.2818s
	iters: 800, epoch: 1 | loss: 0.9477083
	speed: 0.5311s/iter; left time: 5651.8944s
	iters: 900, epoch: 1 | loss: 0.5742822
	speed: 0.5298s/iter; left time: 5585.0778s
	iters: 1000, epoch: 1 | loss: 0.5747704
	speed: 0.5314s/iter; left time: 5548.0917s
	iters: 1100, epoch: 1 | loss: 0.4590989
	speed: 0.5295s/iter; left time: 5475.8148s
Epoch: 1 cost time: 606.813717842102
Epoch: 1, Steps: 1144 | Train Loss: 0.5821713 Vali Loss: 0.5274335 Test Loss: 0.2322755
Validation loss decreased (inf --> 0.527433).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.6341403
	speed: 1.6927s/iter; left time: 17260.7766s
	iters: 200, epoch: 2 | loss: 1.0370150
	speed: 0.5048s/iter; left time: 5097.0985s
	iters: 300, epoch: 2 | loss: 0.4175667
	speed: 0.4970s/iter; left time: 4968.8359s
	iters: 400, epoch: 2 | loss: 0.4288514
	speed: 0.5052s/iter; left time: 4999.7580s
	iters: 500, epoch: 2 | loss: 0.4693474
	speed: 0.5229s/iter; left time: 5123.2391s
	iters: 600, epoch: 2 | loss: 0.4239529
	speed: 0.5295s/iter; left time: 5134.2750s
	iters: 700, epoch: 2 | loss: 0.4339976
	speed: 0.5282s/iter; left time: 5069.0618s
	iters: 800, epoch: 2 | loss: 0.4541781
	speed: 0.5300s/iter; left time: 5033.7685s
	iters: 900, epoch: 2 | loss: 0.4510130
	speed: 0.5305s/iter; left time: 4985.4199s
	iters: 1000, epoch: 2 | loss: 0.5083244
	speed: 0.5287s/iter; left time: 4915.1160s
	iters: 1100, epoch: 2 | loss: 0.9757028
	speed: 0.5288s/iter; left time: 4863.3523s
Epoch: 2 cost time: 593.9901523590088
Epoch: 2, Steps: 1144 | Train Loss: 0.5513196 Vali Loss: 0.5159069 Test Loss: 0.2258607
Validation loss decreased (0.527433 --> 0.515907).  Saving model ...
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.4033624
	speed: 1.7183s/iter; left time: 15555.8185s
	iters: 200, epoch: 3 | loss: 0.5438747
	speed: 0.5286s/iter; left time: 4732.5018s
	iters: 300, epoch: 3 | loss: 0.4283922
	speed: 0.5286s/iter; left time: 4679.3543s
	iters: 400, epoch: 3 | loss: 0.4417813
	speed: 0.5289s/iter; left time: 4629.1875s
	iters: 500, epoch: 3 | loss: 0.4013108
	speed: 0.5296s/iter; left time: 4582.3122s
	iters: 600, epoch: 3 | loss: 0.5543861
	speed: 0.5300s/iter; left time: 4533.1550s
	iters: 700, epoch: 3 | loss: 0.4658077
	speed: 0.5278s/iter; left time: 4461.3319s
	iters: 800, epoch: 3 | loss: 0.4544052
	speed: 0.4990s/iter; left time: 4168.1879s
	iters: 900, epoch: 3 | loss: 1.1531774
	speed: 0.4999s/iter; left time: 4125.7954s
	iters: 1000, epoch: 3 | loss: 0.6081663
	speed: 0.4954s/iter; left time: 4038.6565s
	iters: 1100, epoch: 3 | loss: 0.3764350
	speed: 0.4963s/iter; left time: 3996.3045s
Epoch: 3 cost time: 591.7220964431763
Epoch: 3, Steps: 1144 | Train Loss: 0.5388938 Vali Loss: 0.5144888 Test Loss: 0.2238922
Validation loss decreased (0.515907 --> 0.514489).  Saving model ...
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.4107098
	speed: 1.7217s/iter; left time: 13617.3121s
	iters: 200, epoch: 4 | loss: 0.3636101
	speed: 0.5305s/iter; left time: 4142.7434s
	iters: 300, epoch: 4 | loss: 0.3892092
	speed: 0.5309s/iter; left time: 4092.6340s
	iters: 400, epoch: 4 | loss: 0.3940457
	speed: 0.5312s/iter; left time: 4041.7998s
	iters: 500, epoch: 4 | loss: 0.3574775
	speed: 0.5318s/iter; left time: 3993.0183s
	iters: 600, epoch: 4 | loss: 0.4486671
	speed: 0.5313s/iter; left time: 3936.7056s
	iters: 700, epoch: 4 | loss: 0.5608291
	speed: 0.5306s/iter; left time: 3877.8495s
	iters: 800, epoch: 4 | loss: 0.9065922
	speed: 0.5315s/iter; left time: 3831.9260s
	iters: 900, epoch: 4 | loss: 0.3634594
	speed: 0.5320s/iter; left time: 3781.7187s
	iters: 1000, epoch: 4 | loss: 0.4134143
	speed: 0.5300s/iter; left time: 3715.0509s
	iters: 1100, epoch: 4 | loss: 0.3620422
	speed: 0.5311s/iter; left time: 3669.0740s
Epoch: 4 cost time: 607.525030374527
Epoch: 4, Steps: 1144 | Train Loss: 0.5332476 Vali Loss: 0.5124224 Test Loss: 0.2240827
Validation loss decreased (0.514489 --> 0.512422).  Saving model ...
Updating learning rate to 1.25e-05
	iters: 100, epoch: 5 | loss: 0.4607161
	speed: 1.7057s/iter; left time: 11538.8215s
	iters: 200, epoch: 5 | loss: 0.4195817
	speed: 0.4987s/iter; left time: 3323.9002s
	iters: 300, epoch: 5 | loss: 0.4171945
	speed: 0.5002s/iter; left time: 3283.8269s
	iters: 400, epoch: 5 | loss: 0.3919549
	speed: 0.4996s/iter; left time: 3229.7976s
	iters: 500, epoch: 5 | loss: 0.5340437
	speed: 0.5076s/iter; left time: 3230.7755s
	iters: 600, epoch: 5 | loss: 0.4175372
	speed: 0.5285s/iter; left time: 3310.7778s
	iters: 700, epoch: 5 | loss: 0.8676916
	speed: 0.5289s/iter; left time: 3260.6727s
	iters: 800, epoch: 5 | loss: 0.3990298
	speed: 0.5294s/iter; left time: 3211.0360s
	iters: 900, epoch: 5 | loss: 0.4361970
	speed: 0.5300s/iter; left time: 3161.6584s
	iters: 1000, epoch: 5 | loss: 0.4988273
	speed: 0.5292s/iter; left time: 3103.6911s
	iters: 1100, epoch: 5 | loss: 0.5451043
	speed: 0.5308s/iter; left time: 3060.3195s
Epoch: 5 cost time: 592.8072113990784
Epoch: 5, Steps: 1144 | Train Loss: 0.5300132 Vali Loss: 0.5108058 Test Loss: 0.2228250
Validation loss decreased (0.512422 --> 0.510806).  Saving model ...
Updating learning rate to 6.25e-06
	iters: 100, epoch: 6 | loss: 0.5299715
	speed: 1.7198s/iter; left time: 9667.0721s
	iters: 200, epoch: 6 | loss: 0.3686468
	speed: 0.5291s/iter; left time: 2921.1501s
	iters: 300, epoch: 6 | loss: 0.4309525
	speed: 0.5291s/iter; left time: 2868.2079s
	iters: 400, epoch: 6 | loss: 0.4827594
	speed: 0.5293s/iter; left time: 2816.6208s
	iters: 500, epoch: 6 | loss: 0.4920093
	speed: 0.5305s/iter; left time: 2769.7521s
	iters: 600, epoch: 6 | loss: 0.4280941
	speed: 0.5294s/iter; left time: 2710.8649s
	iters: 700, epoch: 6 | loss: 0.4488004
	speed: 0.5295s/iter; left time: 2658.6078s
	iters: 800, epoch: 6 | loss: 0.8446887
	speed: 0.5165s/iter; left time: 2541.8104s
	iters: 900, epoch: 6 | loss: 0.5245211
	speed: 0.5034s/iter; left time: 2426.9566s
	iters: 1000, epoch: 6 | loss: 0.4941957
	speed: 0.5032s/iter; left time: 2375.7966s
	iters: 1100, epoch: 6 | loss: 0.5916528
	speed: 0.5017s/iter; left time: 2318.5815s
Epoch: 6 cost time: 595.5073781013489
Epoch: 6, Steps: 1144 | Train Loss: 0.5282710 Vali Loss: 0.5159033 Test Loss: 0.2242659
EarlyStopping counter: 1 out of 3
Updating learning rate to 3.125e-06
	iters: 100, epoch: 7 | loss: 0.9575430
	speed: 1.4972s/iter; left time: 6702.7539s
	iters: 200, epoch: 7 | loss: 0.9049421
	speed: 0.4979s/iter; left time: 2179.2543s
	iters: 300, epoch: 7 | loss: 0.3593768
	speed: 0.4976s/iter; left time: 2128.1422s
	iters: 400, epoch: 7 | loss: 0.4136678
	speed: 0.4544s/iter; left time: 1897.9930s
	iters: 500, epoch: 7 | loss: 0.4518697
	speed: 0.4984s/iter; left time: 2032.0271s
	iters: 600, epoch: 7 | loss: 0.4543920
	speed: 0.4982s/iter; left time: 1981.3687s
	iters: 700, epoch: 7 | loss: 0.4300757
	speed: 0.4501s/iter; left time: 1744.9101s
	iters: 800, epoch: 7 | loss: 0.4642483
	speed: 0.4984s/iter; left time: 1882.3098s
	iters: 900, epoch: 7 | loss: 0.3824664
	speed: 0.4966s/iter; left time: 1826.1131s
	iters: 1000, epoch: 7 | loss: 0.5784569
	speed: 0.4614s/iter; left time: 1650.4743s
	iters: 1100, epoch: 7 | loss: 0.5201654
	speed: 0.4900s/iter; left time: 1703.7066s
Epoch: 7 cost time: 545.9390652179718
Epoch: 7, Steps: 1144 | Train Loss: 0.5273575 Vali Loss: 0.5149256 Test Loss: 0.2224885
EarlyStopping counter: 2 out of 3
Updating learning rate to 1.5625e-06
	iters: 100, epoch: 8 | loss: 0.7250890
	speed: 1.5715s/iter; left time: 5237.7481s
	iters: 200, epoch: 8 | loss: 0.4279793
	speed: 0.4970s/iter; left time: 1606.9602s
	iters: 300, epoch: 8 | loss: 0.9233461
	speed: 0.4475s/iter; left time: 1402.0485s
	iters: 400, epoch: 8 | loss: 0.4986147
	speed: 0.4966s/iter; left time: 1506.2301s
	iters: 500, epoch: 8 | loss: 0.4529912
	speed: 0.4972s/iter; left time: 1458.3294s
	iters: 600, epoch: 8 | loss: 0.3384565
	speed: 0.4576s/iter; left time: 1296.3753s
	iters: 700, epoch: 8 | loss: 0.4275860
	speed: 0.4841s/iter; left time: 1323.0915s
	iters: 800, epoch: 8 | loss: 0.4737576
	speed: 0.4977s/iter; left time: 1310.3886s
	iters: 900, epoch: 8 | loss: 0.4876878
	speed: 0.4669s/iter; left time: 1182.7690s
	iters: 1000, epoch: 8 | loss: 0.4503434
	speed: 0.4744s/iter; left time: 1154.1413s
	iters: 1100, epoch: 8 | loss: 0.4195764
	speed: 0.4954s/iter; left time: 1155.6888s
Epoch: 8 cost time: 552.9849722385406
Epoch: 8, Steps: 1144 | Train Loss: 0.5268298 Vali Loss: 0.5169408 Test Loss: 0.2227582
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : AGPT_loss_weather_96_192_AGPT_PT_2048_fixedFalse_0.0001_0.001<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10348
test shape: (10348, 192, 21) (10348, 192, 21)
test shape: (10348, 192, 21) (10348, 192, 21)
mse:0.22307617962360382, mae:0.2575872838497162
Using GPU
Args in experiment:
[1mBasic Config[0m
  Task Name:          AGPT_loss           Is Training:        1                   
  Model ID:           weather_96_336      Model:              AGPT_PT             

[1mData Loader[0m
  Data:               custom              Root Path:          ./dataset/weather/  
  Data Path:          weather.csv         Features:           M                   
  Target:             OT                  Freq:               h                   
  Checkpoints:        ./checkpoints/      

[1mModel Parameters[0m
  Num Kernels:        6                   
  Enc In:             21                  Dec In:             21                  
  C Out:              21                  d model:            512                 
  n heads:            4                   e layers:           2                   
  d layers:           1                   d FF:               2048                
  Moving Avg:         25                  Factor:             3                   
  Distil:             1                   Dropout:            0.1                 
  Embed:              timeF               Activation:         gelu                

[1mRun Parameters[0m
  Num Workers:        10                  Itr:                1                   
  Train Epochs:       10                  Batch Size:         128                 
  Patience:           3                   Learning Rate:      0.0001              
  Des:                Exp                 Loss:               MSE                 
  Lradj:              type1               Use Amp:            0                   

[1mGPU[0m
  Use GPU:            1                   GPU:                0                   
  Use Multi GPU:      0                   Devices:            0,1,2,3             

[1mDe-stationary Projector Params[0m
  P Hidden Dims:      128, 128            P Hidden Layers:    2                   

Use GPU: cuda:0
>>>>>>>start training : AGPT_loss_weather_96_336_AGPT_PT_2048_fixedFalse_0.0001_0.001>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36456
val 4935
test 10204
	iters: 100, epoch: 1 | loss: 0.5816752
	speed: 3.5263s/iter; left time: 9700.7402s
	iters: 200, epoch: 1 | loss: 0.6739342
	speed: 2.5897s/iter; left time: 6865.1913s
Epoch: 1 cost time: 833.5600311756134
Epoch: 1, Steps: 285 | Train Loss: 0.6552282 Vali Loss: 0.6181659 Test Loss: 0.2869987
Validation loss decreased (inf --> 0.618166).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.6038644
	speed: 5.3856s/iter; left time: 13280.7952s
	iters: 200, epoch: 2 | loss: 0.6199358
	speed: 2.5898s/iter; left time: 6127.4566s
Epoch: 2 cost time: 737.6367602348328
Epoch: 2, Steps: 285 | Train Loss: 0.6277985 Vali Loss: 0.6079139 Test Loss: 0.2841241
Validation loss decreased (0.618166 --> 0.607914).  Saving model ...
Updating learning rate to 5e-05
	iters: 100, epoch: 3 | loss: 0.5983962
	speed: 5.3394s/iter; left time: 11645.2759s
	iters: 200, epoch: 3 | loss: 0.7320389
	speed: 2.5800s/iter; left time: 5369.0587s
Epoch: 3 cost time: 734.4148139953613
Epoch: 3, Steps: 285 | Train Loss: 0.6168170 Vali Loss: 0.6057070 Test Loss: 0.2825858
Validation loss decreased (0.607914 --> 0.605707).  Saving model ...
Updating learning rate to 2.5e-05
	iters: 100, epoch: 4 | loss: 0.5362176
	speed: 5.3428s/iter; left time: 10130.0436s
	iters: 200, epoch: 4 | loss: 0.7659956
	speed: 2.5845s/iter; left time: 4641.6969s
Epoch: 4 cost time: 735.0479550361633
Epoch: 4, Steps: 285 | Train Loss: 0.6130885 Vali Loss: 0.6017468 Test Loss: 0.2815594
Validation loss decreased (0.605707 --> 0.601747).  Saving model ...
Updating learning rate to 1.25e-05
	iters: 100, epoch: 5 | loss: 0.6373730
	speed: 5.3314s/iter; left time: 8588.9241s
	iters: 200, epoch: 5 | loss: 0.6998894
	speed: 2.5799s/iter; left time: 3898.2139s
Epoch: 5 cost time: 734.2943258285522
Epoch: 5, Steps: 285 | Train Loss: 0.6109842 Vali Loss: 0.5995812 Test Loss: 0.2808090
Validation loss decreased (0.601747 --> 0.599581).  Saving model ...
Updating learning rate to 6.25e-06
	iters: 100, epoch: 6 | loss: 0.5934664
	speed: 5.3397s/iter; left time: 7080.4138s
	iters: 200, epoch: 6 | loss: 0.6961418
	speed: 2.5843s/iter; left time: 3168.3219s
Epoch: 6 cost time: 736.2661309242249
Epoch: 6, Steps: 285 | Train Loss: 0.6098896 Vali Loss: 0.6001219 Test Loss: 0.2803977
EarlyStopping counter: 1 out of 3
Updating learning rate to 3.125e-06
	iters: 100, epoch: 7 | loss: 0.7346435
	speed: 5.3365s/iter; left time: 5555.3005s
	iters: 200, epoch: 7 | loss: 0.6183638
	speed: 2.5834s/iter; left time: 2430.9664s
Epoch: 7 cost time: 735.9190728664398
Epoch: 7, Steps: 285 | Train Loss: 0.6093295 Vali Loss: 0.6032522 Test Loss: 0.2807796
EarlyStopping counter: 2 out of 3
Updating learning rate to 1.5625e-06
	iters: 100, epoch: 8 | loss: 0.5572499
	speed: 5.3458s/iter; left time: 4041.4076s
	iters: 200, epoch: 8 | loss: 0.6308901
	speed: 2.5872s/iter; left time: 1697.2258s
Epoch: 8 cost time: 735.6876907348633
Epoch: 8, Steps: 285 | Train Loss: 0.6091254 Vali Loss: 0.6019455 Test Loss: 0.2805401
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : AGPT_loss_weather_96_336_AGPT_PT_2048_fixedFalse_0.0001_0.001<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10204
test shape: (10204, 336, 21) (10204, 336, 21)
test shape: (10204, 336, 21) (10204, 336, 21)
mse:0.2806933522224426, mae:0.2984336018562317
Using GPU
Args in experiment:
[1mBasic Config[0m
  Task Name:          AGPT_loss           Is Training:        1                   
  Model ID:           weather_96_720      Model:              AGPT_PT             

[1mData Loader[0m
  Data:               custom              Root Path:          ./dataset/weather/  
  Data Path:          weather.csv         Features:           M                   
  Target:             OT                  Freq:               h                   
  Checkpoints:        ./checkpoints/      

[1mModel Parameters[0m
  Num Kernels:        6                   
  Enc In:             21                  Dec In:             21                  
  C Out:              21                  d model:            512                 
  n heads:            4                   e layers:           2                   
  d layers:           1                   d FF:               2048                
  Moving Avg:         25                  Factor:             3                   
  Distil:             1                   Dropout:            0.1                 
  Embed:              timeF               Activation:         gelu                

[1mRun Parameters[0m
  Num Workers:        10                  Itr:                1                   
  Train Epochs:       10                  Batch Size:         128                 
  Patience:           3                   Learning Rate:      0.0001              
  Des:                Exp                 Loss:               MSE                 
  Lradj:              type1               Use Amp:            0                   

[1mGPU[0m
  Use GPU:            1                   GPU:                0                   
  Use Multi GPU:      0                   Devices:            0,1,2,3             

[1mDe-stationary Projector Params[0m
  P Hidden Dims:      128, 128            P Hidden Layers:    2                   

Use GPU: cuda:0
>>>>>>>start training : AGPT_loss_weather_96_720_AGPT_PT_2048_fixedFalse_0.0001_0.001>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36072
val 4551
test 9820
Traceback (most recent call last):
  File "/mnt/pfs/zitao_team/kuiyeding/AGPT/run.py", line 138, in <module>
    exp.train(setting)
  File "/mnt/pfs/zitao_team/kuiyeding/AGPT/exp/exp_AGPT.py", line 131, in train
    outputs, aux_loss = self.model(batch_x, batch_x_mark, dec_inp, batch_y_mark)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/pfs/zitao_team/kuiyeding/AGPT/models/AGPT_PT.py", line 337, in forward
    dec_out, budget_loss = self.forecast(x_enc, x_mark_enc, x_dec, x_mark_dec)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/pfs/zitao_team/kuiyeding/AGPT/models/AGPT_PT.py", line 268, in forecast
    segment_out, _ = self.encoder(segment_input)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/pfs/zitao_team/kuiyeding/AGPT/layers/Transformer_EncDec.py", line 74, in forward
    x, attn = attn_layer(x, attn_mask=attn_mask, tau=tau, delta=delta)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/pfs/zitao_team/kuiyeding/AGPT/layers/Transformer_EncDec.py", line 48, in forward
    y = self.dropout(self.activation(self.conv1(y.transpose(-1, 1))))
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/conv.py", line 308, in forward
    return self._conv_forward(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/torch/nn/modules/conv.py", line 304, in _conv_forward
    return F.conv1d(input, weight, bias, self.stride,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 316.00 MiB. GPU 0 has a total capacity of 79.15 GiB of which 69.62 MiB is free. Process 1837681 has 79.07 GiB memory in use. Of the allocated memory 78.45 GiB is allocated by PyTorch, and 140.29 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
