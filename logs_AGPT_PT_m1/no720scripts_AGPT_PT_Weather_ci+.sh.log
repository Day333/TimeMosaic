Using GPU
Args in experiment:
[1mBasic Config[0m
  Task Name:          AGPT_loss           Is Training:        1                   
  Model ID:           weather_96_96       Model:              AGPT_PT             

[1mData Loader[0m
  Data:               custom              Root Path:          ./dataset/weather/  
  Data Path:          weather.csv         Features:           M                   
  Target:             OT                  Freq:               h                   
  Checkpoints:        ./checkpoints/      

[1mModel Parameters[0m
  Num Kernels:        6                   
  Enc In:             21                  Dec In:             21                  
  C Out:              21                  d model:            512                 
  n heads:            4                   e layers:           2                   
  d layers:           1                   d FF:               2048                
  Moving Avg:         25                  Factor:             3                   
  Distil:             1                   Dropout:            0.1                 
  Embed:              timeF               Activation:         gelu                

[1mRun Parameters[0m
  Num Workers:        10                  Itr:                1                   
  Train Epochs:       10                  Batch Size:         32                  
  Patience:           3                   Learning Rate:      0.0001              
  Des:                Exp                 Loss:               MSE                 
  Lradj:              type1               Use Amp:            0                   

[1mGPU[0m
  Use GPU:            1                   GPU:                0                   
  Use Multi GPU:      0                   Devices:            0,1,2,3             

[1mDe-stationary Projector Params[0m
  P Hidden Dims:      128, 128            P Hidden Layers:    2                   

Use GPU: cuda:0
>>>>>>>start training : AGPT_loss_weather_96_96_AGPT_PT_2048_fixedFalse_0.0001_0.001_CI+>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36696
val 5175
test 10444
	iters: 100, epoch: 1 | loss: 0.4687848
	speed: 0.2480s/iter; left time: 2820.3579s
	iters: 200, epoch: 1 | loss: 0.4490383
	speed: 0.2580s/iter; left time: 2907.4385s
	iters: 300, epoch: 1 | loss: 0.7357805
	speed: 0.2594s/iter; left time: 2897.4179s
	iters: 400, epoch: 1 | loss: 0.3599066
	speed: 0.2564s/iter; left time: 2838.4662s
	iters: 500, epoch: 1 | loss: 0.5713247
	speed: 0.2596s/iter; left time: 2848.3925s
	iters: 600, epoch: 1 | loss: 0.3500488
	speed: 0.2558s/iter; left time: 2780.9980s
	iters: 700, epoch: 1 | loss: 0.4813635
	speed: 0.2567s/iter; left time: 2764.6864s
	iters: 800, epoch: 1 | loss: 0.3356785
	speed: 0.1838s/iter; left time: 1960.9379s
	iters: 900, epoch: 1 | loss: 0.5012190
	speed: 0.1481s/iter; left time: 1565.3291s
	iters: 1000, epoch: 1 | loss: 0.4496420
	speed: 0.1461s/iter; left time: 1530.2442s
	iters: 1100, epoch: 1 | loss: 0.3834299
	speed: 0.1440s/iter; left time: 1493.3189s
Epoch: 1 cost time: 249.96123814582825
Epoch: 1, Steps: 1147 | Train Loss: 0.5116276 Vali Loss: 0.4407808 Test Loss: 0.1789373
Validation loss decreased (inf --> 0.440781).  Saving model ...
Updating learning rate to 0.0002
	iters: 100, epoch: 2 | loss: 0.4185716
	speed: 1.5232s/iter; left time: 15573.4541s
	iters: 200, epoch: 2 | loss: 0.4414686
	speed: 0.2392s/iter; left time: 2421.4162s
	iters: 300, epoch: 2 | loss: 0.4894034
	speed: 0.2486s/iter; left time: 2491.7242s
	iters: 400, epoch: 2 | loss: 0.2550090
	speed: 0.2486s/iter; left time: 2467.0602s
	iters: 500, epoch: 2 | loss: 0.5818142
	speed: 0.2414s/iter; left time: 2371.4099s
	iters: 600, epoch: 2 | loss: 0.3675642
	speed: 0.2026s/iter; left time: 1970.2749s
	iters: 700, epoch: 2 | loss: 0.3727262
	speed: 0.1536s/iter; left time: 1478.7022s
	iters: 800, epoch: 2 | loss: 0.5082061
	speed: 0.1516s/iter; left time: 1443.9843s
	iters: 900, epoch: 2 | loss: 0.3925952
	speed: 0.1506s/iter; left time: 1419.5117s
	iters: 1000, epoch: 2 | loss: 1.3015170
	speed: 0.1504s/iter; left time: 1401.9518s
	iters: 1100, epoch: 2 | loss: 0.4596922
	speed: 0.1527s/iter; left time: 1408.9120s
Epoch: 2 cost time: 225.59297704696655
Epoch: 2, Steps: 1147 | Train Loss: 0.4871275 Vali Loss: 0.4437305 Test Loss: 0.1825085
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.0001
	iters: 100, epoch: 3 | loss: 0.3230271
	speed: 1.0762s/iter; left time: 9768.8742s
	iters: 200, epoch: 3 | loss: 0.3463775
	speed: 0.2232s/iter; left time: 2003.5659s
	iters: 300, epoch: 3 | loss: 0.3153455
	speed: 0.2200s/iter; left time: 1953.1499s
	iters: 400, epoch: 3 | loss: 0.3985722
	speed: 0.2233s/iter; left time: 1959.6146s
	iters: 500, epoch: 3 | loss: 0.3265690
	speed: 0.2179s/iter; left time: 1890.6120s
	iters: 600, epoch: 3 | loss: 0.3824314
	speed: 0.1970s/iter; left time: 1689.2545s
	iters: 700, epoch: 3 | loss: 0.4165980
	speed: 0.1539s/iter; left time: 1304.5098s
	iters: 800, epoch: 3 | loss: 0.5152879
	speed: 0.1532s/iter; left time: 1283.6099s
	iters: 900, epoch: 3 | loss: 0.6175326
	speed: 0.1538s/iter; left time: 1272.9186s
	iters: 1000, epoch: 3 | loss: 1.1879727
	speed: 0.1513s/iter; left time: 1237.0672s
	iters: 1100, epoch: 3 | loss: 0.4784214
	speed: 0.1513s/iter; left time: 1222.2461s
Epoch: 3 cost time: 214.24572277069092
Epoch: 3, Steps: 1147 | Train Loss: 0.4643957 Vali Loss: 0.4317159 Test Loss: 0.1715652
Validation loss decreased (0.440781 --> 0.431716).  Saving model ...
Updating learning rate to 5e-05
	iters: 100, epoch: 4 | loss: 0.3820871
	speed: 1.0727s/iter; left time: 8506.3901s
	iters: 200, epoch: 4 | loss: 0.4054745
	speed: 0.2229s/iter; left time: 1745.3436s
	iters: 300, epoch: 4 | loss: 0.2928154
	speed: 0.2225s/iter; left time: 1720.0649s
	iters: 400, epoch: 4 | loss: 0.3746733
	speed: 0.2210s/iter; left time: 1686.3333s
	iters: 500, epoch: 4 | loss: 0.4615346
	speed: 0.2221s/iter; left time: 1672.2242s
	iters: 600, epoch: 4 | loss: 0.4446476
	speed: 0.1859s/iter; left time: 1381.4944s
	iters: 700, epoch: 4 | loss: 0.2776217
	speed: 0.1533s/iter; left time: 1123.5477s
	iters: 800, epoch: 4 | loss: 1.1907057
	speed: 0.1535s/iter; left time: 1109.6724s
	iters: 900, epoch: 4 | loss: 0.3866206
	speed: 0.1515s/iter; left time: 1079.9107s
	iters: 1000, epoch: 4 | loss: 0.3936891
	speed: 0.1552s/iter; left time: 1091.2374s
	iters: 1100, epoch: 4 | loss: 0.3015248
	speed: 0.1532s/iter; left time: 1061.8311s
Epoch: 4 cost time: 213.85982751846313
Epoch: 4, Steps: 1147 | Train Loss: 0.4526412 Vali Loss: 0.4273105 Test Loss: 0.1723945
Validation loss decreased (0.431716 --> 0.427311).  Saving model ...
Updating learning rate to 2.5e-05
	iters: 100, epoch: 5 | loss: 0.4069172
	speed: 1.0784s/iter; left time: 7314.4856s
	iters: 200, epoch: 5 | loss: 0.4507744
	speed: 0.2227s/iter; left time: 1488.5828s
	iters: 300, epoch: 5 | loss: 1.3230697
	speed: 0.2198s/iter; left time: 1446.9782s
	iters: 400, epoch: 5 | loss: 0.3185676
	speed: 0.2199s/iter; left time: 1425.9203s
	iters: 500, epoch: 5 | loss: 0.2635049
	speed: 0.2209s/iter; left time: 1409.9490s
	iters: 600, epoch: 5 | loss: 0.3610131
	speed: 0.1767s/iter; left time: 1110.4998s
	iters: 700, epoch: 5 | loss: 1.2528092
	speed: 0.1546s/iter; left time: 956.1316s
	iters: 800, epoch: 5 | loss: 0.4490350
	speed: 0.1542s/iter; left time: 937.9829s
	iters: 900, epoch: 5 | loss: 0.3573230
	speed: 0.1543s/iter; left time: 923.4043s
	iters: 1000, epoch: 5 | loss: 0.4505042
	speed: 0.1516s/iter; left time: 892.0224s
	iters: 1100, epoch: 5 | loss: 0.2508584
	speed: 0.1512s/iter; left time: 874.3150s
Epoch: 5 cost time: 212.0773901939392
Epoch: 5, Steps: 1147 | Train Loss: 0.4459159 Vali Loss: 0.4306436 Test Loss: 0.1721682
EarlyStopping counter: 1 out of 3
Updating learning rate to 1.25e-05
	iters: 100, epoch: 6 | loss: 0.3852565
	speed: 0.9329s/iter; left time: 5257.6035s
	iters: 200, epoch: 6 | loss: 0.3680028
	speed: 0.1377s/iter; left time: 762.3904s
	iters: 300, epoch: 6 | loss: 0.2497572
	speed: 0.1381s/iter; left time: 750.5169s
	iters: 400, epoch: 6 | loss: 0.2359972
	speed: 0.1352s/iter; left time: 721.5307s
	iters: 500, epoch: 6 | loss: 0.4307023
	speed: 0.1464s/iter; left time: 766.3044s
	iters: 600, epoch: 6 | loss: 0.4414706
	speed: 0.1449s/iter; left time: 744.3982s
	iters: 700, epoch: 6 | loss: 0.3387877
	speed: 0.1448s/iter; left time: 729.3278s
	iters: 800, epoch: 6 | loss: 0.3058951
	speed: 0.1447s/iter; left time: 714.2030s
	iters: 900, epoch: 6 | loss: 1.2505685
	speed: 0.1032s/iter; left time: 499.2893s
	iters: 1000, epoch: 6 | loss: 0.5059487
	speed: 0.1007s/iter; left time: 477.1175s
	iters: 1100, epoch: 6 | loss: 0.4057903
	speed: 0.1135s/iter; left time: 526.3552s
Epoch: 6 cost time: 152.6201765537262
Epoch: 6, Steps: 1147 | Train Loss: 0.4424158 Vali Loss: 0.4267199 Test Loss: 0.1695683
Validation loss decreased (0.427311 --> 0.426720).  Saving model ...
Updating learning rate to 6.25e-06
	iters: 100, epoch: 7 | loss: 0.4300607
	speed: 0.6526s/iter; left time: 2929.3562s
	iters: 200, epoch: 7 | loss: 1.2416706
	speed: 0.1124s/iter; left time: 493.2252s
	iters: 300, epoch: 7 | loss: 0.5465004
	speed: 0.1130s/iter; left time: 484.5117s
	iters: 400, epoch: 7 | loss: 0.2977187
	speed: 0.1033s/iter; left time: 432.8875s
	iters: 500, epoch: 7 | loss: 0.5400186
	speed: 0.1095s/iter; left time: 447.5917s
	iters: 600, epoch: 7 | loss: 0.2980382
	speed: 0.1135s/iter; left time: 452.7955s
	iters: 700, epoch: 7 | loss: 0.3381465
	speed: 0.1658s/iter; left time: 644.8528s
	iters: 800, epoch: 7 | loss: 0.2660960
	speed: 0.1846s/iter; left time: 699.4952s
	iters: 900, epoch: 7 | loss: 1.2847944
	speed: 0.1924s/iter; left time: 709.7285s
	iters: 1000, epoch: 7 | loss: 0.2793591
	speed: 0.2115s/iter; left time: 758.9814s
	iters: 1100, epoch: 7 | loss: 0.4984134
	speed: 0.2114s/iter; left time: 737.5170s
Epoch: 7 cost time: 173.8027262687683
Epoch: 7, Steps: 1147 | Train Loss: 0.4402901 Vali Loss: 0.4238254 Test Loss: 0.1695676
Validation loss decreased (0.426720 --> 0.423825).  Saving model ...
Updating learning rate to 3.125e-06
	iters: 100, epoch: 8 | loss: 0.5131646
	speed: 1.9760s/iter; left time: 6603.8390s
	iters: 200, epoch: 8 | loss: 0.3057469
	speed: 0.1812s/iter; left time: 587.3809s
	iters: 300, epoch: 8 | loss: 0.4938706
	speed: 0.2135s/iter; left time: 670.6772s
	iters: 400, epoch: 8 | loss: 0.5539420
	speed: 0.2121s/iter; left time: 645.0924s
	iters: 500, epoch: 8 | loss: 0.4365142
	speed: 0.2089s/iter; left time: 614.6231s
	iters: 600, epoch: 8 | loss: 0.2299626
	speed: 0.2483s/iter; left time: 705.6850s
	iters: 700, epoch: 8 | loss: 0.3382931
	speed: 0.2328s/iter; left time: 638.2746s
	iters: 800, epoch: 8 | loss: 0.4730830
	speed: 0.2284s/iter; left time: 603.5296s
	iters: 900, epoch: 8 | loss: 0.3370426
	speed: 0.2370s/iter; left time: 602.3684s
	iters: 1000, epoch: 8 | loss: 0.2846914
	speed: 0.1847s/iter; left time: 451.0307s
	iters: 1100, epoch: 8 | loss: 0.2123537
	speed: 0.1908s/iter; left time: 446.9261s
Epoch: 8 cost time: 241.28295016288757
Epoch: 8, Steps: 1147 | Train Loss: 0.4391208 Vali Loss: 0.4242931 Test Loss: 0.1695490
EarlyStopping counter: 1 out of 3
Updating learning rate to 1.5625e-06
	iters: 100, epoch: 9 | loss: 0.2765273
	speed: 1.9640s/iter; left time: 4311.0381s
	iters: 200, epoch: 9 | loss: 0.2630029
	speed: 0.2458s/iter; left time: 514.9366s
	iters: 300, epoch: 9 | loss: 0.3722353
	speed: 0.2592s/iter; left time: 517.0847s
	iters: 400, epoch: 9 | loss: 0.3202390
	speed: 0.2489s/iter; left time: 471.6826s
	iters: 500, epoch: 9 | loss: 0.3743579
	speed: 0.2291s/iter; left time: 411.3232s
	iters: 600, epoch: 9 | loss: 0.2536584
	speed: 0.1894s/iter; left time: 321.0360s
	iters: 700, epoch: 9 | loss: 0.3587008
	speed: 0.1899s/iter; left time: 302.8697s
	iters: 800, epoch: 9 | loss: 0.3138056
	speed: 0.1890s/iter; left time: 282.5479s
	iters: 900, epoch: 9 | loss: 0.3564279
	speed: 0.1994s/iter; left time: 278.1596s
	iters: 1000, epoch: 9 | loss: 0.3759644
	speed: 0.1904s/iter; left time: 246.6192s
	iters: 1100, epoch: 9 | loss: 0.5330643
	speed: 0.1923s/iter; left time: 229.7740s
Epoch: 9 cost time: 246.68932366371155
Epoch: 9, Steps: 1147 | Train Loss: 0.4387886 Vali Loss: 0.4246415 Test Loss: 0.1697960
EarlyStopping counter: 2 out of 3
Updating learning rate to 7.8125e-07
	iters: 100, epoch: 10 | loss: 0.3853028
	speed: 1.8955s/iter; left time: 1986.4799s
	iters: 200, epoch: 10 | loss: 0.3136629
	speed: 0.1894s/iter; left time: 179.5236s
	iters: 300, epoch: 10 | loss: 0.2898875
	speed: 0.1886s/iter; left time: 159.9481s
	iters: 400, epoch: 10 | loss: 0.3027576
	speed: 0.1913s/iter; left time: 143.0685s
	iters: 500, epoch: 10 | loss: 0.3548063
	speed: 0.1921s/iter; left time: 124.4693s
	iters: 600, epoch: 10 | loss: 0.2939230
	speed: 0.1945s/iter; left time: 106.5875s
	iters: 700, epoch: 10 | loss: 0.4302131
	speed: 0.1971s/iter; left time: 88.3156s
	iters: 800, epoch: 10 | loss: 0.4629510
	speed: 0.1936s/iter; left time: 67.3693s
	iters: 900, epoch: 10 | loss: 0.3217599
	speed: 0.1909s/iter; left time: 47.3324s
	iters: 1000, epoch: 10 | loss: 0.4117105
	speed: 0.2252s/iter; left time: 33.3296s
	iters: 1100, epoch: 10 | loss: 0.3515216
	speed: 0.2365s/iter; left time: 11.3525s
Epoch: 10 cost time: 234.51090168952942
Epoch: 10, Steps: 1147 | Train Loss: 0.4383492 Vali Loss: 0.4249872 Test Loss: 0.1700701
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : AGPT_loss_weather_96_96_AGPT_PT_2048_fixedFalse_0.0001_0.001_CI+<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10444
test shape: (10444, 96, 21) (10444, 96, 21)
test shape: (10444, 96, 21) (10444, 96, 21)
mse:0.16981647908687592, mae:0.2093643695116043, rmse:0.41208794713020325, mape:15.214654922485352, mspe:27822744.0
================================================================================
Model Profiling Summary
Total Params             : 6,982,541
Inference Time (s)       : 0.131413
GPU Mem Footprint (MB)   : 80.91
Peak Mem (MB)            : 523.71
================================================================================
Using GPU
Args in experiment:
[1mBasic Config[0m
  Task Name:          AGPT_loss           Is Training:        1                   
  Model ID:           weather_96_192      Model:              AGPT_PT             

[1mData Loader[0m
  Data:               custom              Root Path:          ./dataset/weather/  
  Data Path:          weather.csv         Features:           M                   
  Target:             OT                  Freq:               h                   
  Checkpoints:        ./checkpoints/      

[1mModel Parameters[0m
  Num Kernels:        6                   
  Enc In:             21                  Dec In:             21                  
  C Out:              21                  d model:            512                 
  n heads:            16                  e layers:           2                   
  d layers:           1                   d FF:               2048                
  Moving Avg:         25                  Factor:             3                   
  Distil:             1                   Dropout:            0.1                 
  Embed:              timeF               Activation:         gelu                

[1mRun Parameters[0m
  Num Workers:        10                  Itr:                1                   
  Train Epochs:       10                  Batch Size:         32                  
  Patience:           3                   Learning Rate:      0.0001              
  Des:                Exp                 Loss:               MSE                 
  Lradj:              type1               Use Amp:            0                   

[1mGPU[0m
  Use GPU:            1                   GPU:                0                   
  Use Multi GPU:      0                   Devices:            0,1,2,3             

[1mDe-stationary Projector Params[0m
  P Hidden Dims:      128, 128            P Hidden Layers:    2                   

Use GPU: cuda:0
>>>>>>>start training : AGPT_loss_weather_96_192_AGPT_PT_2048_fixedFalse_0.0001_0.001_CI+>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36600
val 5079
test 10348
	iters: 100, epoch: 1 | loss: 0.5228735
	speed: 0.2119s/iter; left time: 2403.0693s
	iters: 200, epoch: 1 | loss: 0.9911005
	speed: 0.2039s/iter; left time: 2292.4398s
	iters: 300, epoch: 1 | loss: 1.0202010
	speed: 0.2391s/iter; left time: 2663.8262s
	iters: 400, epoch: 1 | loss: 0.5043629
	speed: 0.2358s/iter; left time: 2603.7452s
	iters: 500, epoch: 1 | loss: 1.0716122
	speed: 0.2374s/iter; left time: 2597.8737s
	iters: 600, epoch: 1 | loss: 0.4656312
	speed: 0.2451s/iter; left time: 2656.6594s
	iters: 700, epoch: 1 | loss: 0.4498183
	speed: 0.2602s/iter; left time: 2794.4961s
	iters: 800, epoch: 1 | loss: 0.4378136
	speed: 0.2536s/iter; left time: 2698.8100s
	iters: 900, epoch: 1 | loss: 1.3530872
	speed: 0.2316s/iter; left time: 2441.4821s
	iters: 1000, epoch: 1 | loss: 0.4143638
	speed: 0.1939s/iter; left time: 2024.7049s
	iters: 1100, epoch: 1 | loss: 0.3554089
	speed: 0.1849s/iter; left time: 1911.7656s
Epoch: 1 cost time: 258.33803606033325
Epoch: 1, Steps: 1144 | Train Loss: 0.5725827 Vali Loss: 0.5179419 Test Loss: 0.2286221
Validation loss decreased (inf --> 0.517942).  Saving model ...
Updating learning rate to 0.0002
	iters: 100, epoch: 2 | loss: 0.4606598
	speed: 1.9348s/iter; left time: 19728.7751s
	iters: 200, epoch: 2 | loss: 0.5636878
	speed: 0.2508s/iter; left time: 2532.7919s
	iters: 300, epoch: 2 | loss: 0.4674502
	speed: 0.2405s/iter; left time: 2404.2755s
	iters: 400, epoch: 2 | loss: 0.3752828
	speed: 0.2406s/iter; left time: 2381.1082s
	iters: 500, epoch: 2 | loss: 0.4865837
	speed: 0.2172s/iter; left time: 2127.4311s
	iters: 600, epoch: 2 | loss: 0.5582601
	speed: 0.1894s/iter; left time: 1836.3369s
	iters: 700, epoch: 2 | loss: 0.4269382
	speed: 0.1955s/iter; left time: 1876.4306s
	iters: 800, epoch: 2 | loss: 0.4245050
	speed: 0.1927s/iter; left time: 1830.4160s
	iters: 900, epoch: 2 | loss: 0.3700090
	speed: 0.1886s/iter; left time: 1772.2477s
	iters: 1000, epoch: 2 | loss: 0.5213191
	speed: 0.1778s/iter; left time: 1653.1274s
	iters: 1100, epoch: 2 | loss: 0.3461832
	speed: 0.1778s/iter; left time: 1634.8041s
Epoch: 2 cost time: 242.13493418693542
Epoch: 2, Steps: 1144 | Train Loss: 0.5447927 Vali Loss: 0.5092181 Test Loss: 0.2225376
Validation loss decreased (0.517942 --> 0.509218).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 3 | loss: 0.7084372
	speed: 1.9075s/iter; left time: 17268.2292s
	iters: 200, epoch: 3 | loss: 0.4584394
	speed: 0.1723s/iter; left time: 1542.6753s
	iters: 300, epoch: 3 | loss: 0.4021884
	speed: 0.1794s/iter; left time: 1588.4047s
	iters: 400, epoch: 3 | loss: 0.3865243
	speed: 0.1795s/iter; left time: 1571.4514s
	iters: 500, epoch: 3 | loss: 0.9118864
	speed: 0.1696s/iter; left time: 1467.2357s
	iters: 600, epoch: 3 | loss: 0.3444545
	speed: 0.1772s/iter; left time: 1515.2790s
	iters: 700, epoch: 3 | loss: 0.2920368
	speed: 0.1763s/iter; left time: 1489.8739s
	iters: 800, epoch: 3 | loss: 0.4440206
	speed: 0.1775s/iter; left time: 1482.6166s
	iters: 900, epoch: 3 | loss: 0.5076826
	speed: 0.1776s/iter; left time: 1466.1128s
	iters: 1000, epoch: 3 | loss: 0.3433181
	speed: 0.1903s/iter; left time: 1551.1251s
	iters: 1100, epoch: 3 | loss: 0.5067314
	speed: 0.2099s/iter; left time: 1690.0116s
Epoch: 3 cost time: 210.30780911445618
Epoch: 3, Steps: 1144 | Train Loss: 0.5243888 Vali Loss: 0.5091484 Test Loss: 0.2207786
Validation loss decreased (0.509218 --> 0.509148).  Saving model ...
Updating learning rate to 5e-05
	iters: 100, epoch: 4 | loss: 0.4641152
	speed: 1.9141s/iter; left time: 15138.9856s
	iters: 200, epoch: 4 | loss: 0.4488170
	speed: 0.1775s/iter; left time: 1386.0158s
	iters: 300, epoch: 4 | loss: 0.8859562
	speed: 0.1773s/iter; left time: 1366.7651s
	iters: 400, epoch: 4 | loss: 0.4871639
	speed: 0.1679s/iter; left time: 1277.6858s
	iters: 500, epoch: 4 | loss: 0.4511241
	speed: 0.1792s/iter; left time: 1345.8229s
	iters: 600, epoch: 4 | loss: 0.8429830
	speed: 0.1911s/iter; left time: 1415.5679s
	iters: 700, epoch: 4 | loss: 0.3700503
	speed: 0.2042s/iter; left time: 1492.6831s
	iters: 800, epoch: 4 | loss: 0.3596925
	speed: 0.2250s/iter; left time: 1622.2315s
	iters: 900, epoch: 4 | loss: 0.5300422
	speed: 0.2462s/iter; left time: 1750.1992s
	iters: 1000, epoch: 4 | loss: 0.4762815
	speed: 0.2428s/iter; left time: 1701.7297s
	iters: 1100, epoch: 4 | loss: 0.9621058
	speed: 0.2516s/iter; left time: 1738.3306s
Epoch: 4 cost time: 235.7803726196289
Epoch: 4, Steps: 1144 | Train Loss: 0.5136385 Vali Loss: 0.5030125 Test Loss: 0.2208176
Validation loss decreased (0.509148 --> 0.503013).  Saving model ...
Updating learning rate to 2.5e-05
	iters: 100, epoch: 5 | loss: 0.4015900
	speed: 2.0037s/iter; left time: 13554.7352s
	iters: 200, epoch: 5 | loss: 0.5262853
	speed: 0.1968s/iter; left time: 1311.7343s
	iters: 300, epoch: 5 | loss: 0.3913136
	speed: 0.1912s/iter; left time: 1254.9188s
	iters: 400, epoch: 5 | loss: 0.4004572
	speed: 0.1835s/iter; left time: 1186.5962s
	iters: 500, epoch: 5 | loss: 0.8854644
	speed: 0.1748s/iter; left time: 1112.4090s
	iters: 600, epoch: 5 | loss: 0.4720972
	speed: 0.1699s/iter; left time: 1064.3128s
	iters: 700, epoch: 5 | loss: 0.4521826
	speed: 0.1647s/iter; left time: 1015.4076s
	iters: 800, epoch: 5 | loss: 0.8173553
	speed: 0.1769s/iter; left time: 1072.7344s
	iters: 900, epoch: 5 | loss: 0.4713358
	speed: 0.1651s/iter; left time: 984.6245s
	iters: 1000, epoch: 5 | loss: 0.5371274
	speed: 0.1593s/iter; left time: 934.0519s
	iters: 1100, epoch: 5 | loss: 0.4083686
	speed: 0.1777s/iter; left time: 1024.3682s
Epoch: 5 cost time: 203.50039434432983
Epoch: 5, Steps: 1144 | Train Loss: 0.5069036 Vali Loss: 0.5018909 Test Loss: 0.2203164
Validation loss decreased (0.503013 --> 0.501891).  Saving model ...
Updating learning rate to 1.25e-05
	iters: 100, epoch: 6 | loss: 0.3696782
	speed: 1.1201s/iter; left time: 6295.8217s
	iters: 200, epoch: 6 | loss: 0.3370128
	speed: 0.1641s/iter; left time: 905.8429s
	iters: 300, epoch: 6 | loss: 0.3954976
	speed: 0.1756s/iter; left time: 951.9789s
	iters: 400, epoch: 6 | loss: 0.3786488
	speed: 0.1569s/iter; left time: 835.0333s
	iters: 500, epoch: 6 | loss: 0.4281938
	speed: 0.1762s/iter; left time: 920.0246s
	iters: 600, epoch: 6 | loss: 0.4531021
	speed: 0.1680s/iter; left time: 860.5552s
	iters: 700, epoch: 6 | loss: 0.5675586
	speed: 0.1589s/iter; left time: 797.7739s
	iters: 800, epoch: 6 | loss: 0.4228305
	speed: 0.1780s/iter; left time: 876.1408s
	iters: 900, epoch: 6 | loss: 0.4719886
	speed: 0.1701s/iter; left time: 819.9479s
	iters: 1000, epoch: 6 | loss: 0.3622265
	speed: 0.1612s/iter; left time: 761.1927s
	iters: 1100, epoch: 6 | loss: 0.3262187
	speed: 0.1813s/iter; left time: 837.5751s
Epoch: 6 cost time: 192.97936034202576
Epoch: 6, Steps: 1144 | Train Loss: 0.5031119 Vali Loss: 0.5024171 Test Loss: 0.2198598
EarlyStopping counter: 1 out of 3
Updating learning rate to 6.25e-06
	iters: 100, epoch: 7 | loss: 0.3764899
	speed: 1.1880s/iter; left time: 5318.7114s
	iters: 200, epoch: 7 | loss: 0.4187006
	speed: 0.1704s/iter; left time: 745.8996s
	iters: 300, epoch: 7 | loss: 0.3691855
	speed: 0.1675s/iter; left time: 716.2819s
	iters: 400, epoch: 7 | loss: 0.8186896
	speed: 0.1782s/iter; left time: 744.4664s
	iters: 500, epoch: 7 | loss: 0.5063741
	speed: 0.1662s/iter; left time: 677.7053s
	iters: 600, epoch: 7 | loss: 0.5339100
	speed: 0.1610s/iter; left time: 640.3690s
	iters: 700, epoch: 7 | loss: 0.8283421
	speed: 0.1781s/iter; left time: 690.3190s
	iters: 800, epoch: 7 | loss: 0.4870269
	speed: 0.1657s/iter; left time: 625.8491s
	iters: 900, epoch: 7 | loss: 0.9229130
	speed: 0.1636s/iter; left time: 601.4613s
	iters: 1000, epoch: 7 | loss: 0.4561308
	speed: 0.1790s/iter; left time: 640.3787s
	iters: 1100, epoch: 7 | loss: 0.9486135
	speed: 0.1651s/iter; left time: 574.0208s
Epoch: 7 cost time: 194.8890130519867
Epoch: 7, Steps: 1144 | Train Loss: 0.5009404 Vali Loss: 0.5021304 Test Loss: 0.2200388
EarlyStopping counter: 2 out of 3
Updating learning rate to 3.125e-06
	iters: 100, epoch: 8 | loss: 0.4430794
	speed: 1.0872s/iter; left time: 3623.4811s
	iters: 200, epoch: 8 | loss: 0.3861113
	speed: 0.1652s/iter; left time: 534.1316s
	iters: 300, epoch: 8 | loss: 0.3818016
	speed: 0.1696s/iter; left time: 531.3401s
	iters: 400, epoch: 8 | loss: 0.3555319
	speed: 0.1684s/iter; left time: 510.7779s
	iters: 500, epoch: 8 | loss: 0.4309208
	speed: 0.1671s/iter; left time: 490.1389s
	iters: 600, epoch: 8 | loss: 0.4543221
	speed: 0.1707s/iter; left time: 483.6403s
	iters: 700, epoch: 8 | loss: 0.5721705
	speed: 0.1656s/iter; left time: 452.4743s
	iters: 800, epoch: 8 | loss: 0.7008476
	speed: 0.1706s/iter; left time: 449.2607s
	iters: 900, epoch: 8 | loss: 0.6943569
	speed: 0.1647s/iter; left time: 417.1699s
	iters: 1000, epoch: 8 | loss: 0.3556218
	speed: 0.1709s/iter; left time: 415.8268s
	iters: 1100, epoch: 8 | loss: 0.4067797
	speed: 0.1682s/iter; left time: 392.4785s
Epoch: 8 cost time: 192.77268815040588
Epoch: 8, Steps: 1144 | Train Loss: 0.4996926 Vali Loss: 0.5028918 Test Loss: 0.2200121
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : AGPT_loss_weather_96_192_AGPT_PT_2048_fixedFalse_0.0001_0.001_CI+<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10348
test shape: (10348, 192, 21) (10348, 192, 21)
test shape: (10348, 192, 21) (10348, 192, 21)
mse:0.22063562273979187, mae:0.25370341539382935, rmse:0.46971866488456726, mape:15.553372383117676, mspe:25257088.0
================================================================================
Model Profiling Summary
Total Params             : 7,572,461
Inference Time (s)       : 0.031457
GPU Mem Footprint (MB)   : 86.31
Peak Mem (MB)            : 529.02
================================================================================
Using GPU
Args in experiment:
[1mBasic Config[0m
  Task Name:          AGPT_loss           Is Training:        1                   
  Model ID:           weather_96_336      Model:              AGPT_PT             

[1mData Loader[0m
  Data:               custom              Root Path:          ./dataset/weather/  
  Data Path:          weather.csv         Features:           M                   
  Target:             OT                  Freq:               h                   
  Checkpoints:        ./checkpoints/      

[1mModel Parameters[0m
  Num Kernels:        6                   
  Enc In:             21                  Dec In:             21                  
  C Out:              21                  d model:            512                 
  n heads:            4                   e layers:           2                   
  d layers:           1                   d FF:               2048                
  Moving Avg:         25                  Factor:             3                   
  Distil:             1                   Dropout:            0.1                 
  Embed:              timeF               Activation:         gelu                

[1mRun Parameters[0m
  Num Workers:        10                  Itr:                1                   
  Train Epochs:       10                  Batch Size:         128                 
  Patience:           3                   Learning Rate:      0.0001              
  Des:                Exp                 Loss:               MSE                 
  Lradj:              type1               Use Amp:            0                   

[1mGPU[0m
  Use GPU:            1                   GPU:                0                   
  Use Multi GPU:      0                   Devices:            0,1,2,3             

[1mDe-stationary Projector Params[0m
  P Hidden Dims:      128, 128            P Hidden Layers:    2                   

Use GPU: cuda:0
>>>>>>>start training : AGPT_loss_weather_96_336_AGPT_PT_2048_fixedFalse_0.0001_0.001_CI+>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36456
val 4935
test 10204
	iters: 100, epoch: 1 | loss: 0.5679083
	speed: 0.3523s/iter; left time: 969.1447s
	iters: 200, epoch: 1 | loss: 0.7142930
	speed: 0.3544s/iter; left time: 939.3970s
Epoch: 1 cost time: 99.07254719734192
Epoch: 1, Steps: 285 | Train Loss: 0.6552881 Vali Loss: 0.6295235 Test Loss: 0.2903171
Validation loss decreased (inf --> 0.629523).  Saving model ...
Updating learning rate to 0.0002
	iters: 100, epoch: 2 | loss: 0.5995102
	speed: 1.0097s/iter; left time: 2489.9092s
	iters: 200, epoch: 2 | loss: 0.5933733
	speed: 0.3486s/iter; left time: 824.8122s
Epoch: 2 cost time: 98.74914288520813
Epoch: 2, Steps: 285 | Train Loss: 0.6228508 Vali Loss: 0.6049489 Test Loss: 0.2803699
Validation loss decreased (0.629523 --> 0.604949).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 3 | loss: 0.7217157
	speed: 1.0040s/iter; left time: 2189.7409s
	iters: 200, epoch: 3 | loss: 0.8490778
	speed: 0.3441s/iter; left time: 715.9831s
Epoch: 3 cost time: 97.88047790527344
Epoch: 3, Steps: 285 | Train Loss: 0.6068089 Vali Loss: 0.5989762 Test Loss: 0.2777587
Validation loss decreased (0.604949 --> 0.598976).  Saving model ...
Updating learning rate to 5e-05
	iters: 100, epoch: 4 | loss: 0.4651873
	speed: 1.0297s/iter; left time: 1952.3522s
	iters: 200, epoch: 4 | loss: 0.7675236
	speed: 0.4004s/iter; left time: 719.0677s
Epoch: 4 cost time: 112.3779022693634
Epoch: 4, Steps: 285 | Train Loss: 0.5999634 Vali Loss: 0.6026872 Test Loss: 0.2790609
EarlyStopping counter: 1 out of 3
Updating learning rate to 2.5e-05
	iters: 100, epoch: 5 | loss: 0.5102071
	speed: 1.1957s/iter; left time: 1926.1925s
	iters: 200, epoch: 5 | loss: 0.6356435
	speed: 0.4003s/iter; left time: 604.7967s
Epoch: 5 cost time: 117.22178244590759
Epoch: 5, Steps: 285 | Train Loss: 0.5966062 Vali Loss: 0.5981554 Test Loss: 0.2777378
Validation loss decreased (0.598976 --> 0.598155).  Saving model ...
Updating learning rate to 1.25e-05
	iters: 100, epoch: 6 | loss: 0.6656775
	speed: 1.1480s/iter; left time: 1522.1955s
	iters: 200, epoch: 6 | loss: 0.5935479
	speed: 0.4131s/iter; left time: 506.4342s
Epoch: 6 cost time: 116.1312096118927
Epoch: 6, Steps: 285 | Train Loss: 0.5949054 Vali Loss: 0.5957859 Test Loss: 0.2764122
Validation loss decreased (0.598155 --> 0.595786).  Saving model ...
Updating learning rate to 6.25e-06
	iters: 100, epoch: 7 | loss: 0.6661655
	speed: 1.1587s/iter; left time: 1206.1957s
	iters: 200, epoch: 7 | loss: 0.5699429
	speed: 0.4079s/iter; left time: 383.7898s
Epoch: 7 cost time: 117.81971645355225
Epoch: 7, Steps: 285 | Train Loss: 0.5938226 Vali Loss: 0.5985719 Test Loss: 0.2767008
EarlyStopping counter: 1 out of 3
Updating learning rate to 3.125e-06
	iters: 100, epoch: 8 | loss: 0.5386966
	speed: 1.2079s/iter; left time: 913.1505s
	iters: 200, epoch: 8 | loss: 0.5907816
	speed: 0.4018s/iter; left time: 263.5916s
Epoch: 8 cost time: 117.32224345207214
Epoch: 8, Steps: 285 | Train Loss: 0.5933069 Vali Loss: 0.5969357 Test Loss: 0.2766542
EarlyStopping counter: 2 out of 3
Updating learning rate to 1.5625e-06
	iters: 100, epoch: 9 | loss: 0.6819571
	speed: 1.1644s/iter; left time: 548.4427s
	iters: 200, epoch: 9 | loss: 0.7284535
	speed: 0.4040s/iter; left time: 149.8868s
Epoch: 9 cost time: 116.6901421546936
Epoch: 9, Steps: 285 | Train Loss: 0.5929559 Vali Loss: 0.5980697 Test Loss: 0.2767072
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : AGPT_loss_weather_96_336_AGPT_PT_2048_fixedFalse_0.0001_0.001_CI+<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10204
test shape: (10204, 336, 21) (10204, 336, 21)
test shape: (10204, 336, 21) (10204, 336, 21)
mse:0.2763811945915222, mae:0.2952355742454529, rmse:0.5257197022438049, mape:15.95789623260498, mspe:26460674.0
================================================================================
Model Profiling Summary
Total Params             : 8,455,293
Inference Time (s)       : 0.085487
GPU Mem Footprint (MB)   : 107.98
Peak Mem (MB)            : 1865.76
================================================================================
Using GPU
Args in experiment:
[1mBasic Config[0m
  Task Name:          AGPT_loss           Is Training:        1                   
  Model ID:           weather_96_720      Model:              AGPT_PT             

[1mData Loader[0m
  Data:               custom              Root Path:          ./dataset/weather/  
  Data Path:          weather.csv         Features:           M                   
  Target:             OT                  Freq:               h                   
  Checkpoints:        ./checkpoints/      

[1mModel Parameters[0m
  Num Kernels:        6                   
  Enc In:             21                  Dec In:             21                  
  C Out:              21                  d model:            512                 
  n heads:            4                   e layers:           2                   
  d layers:           1                   d FF:               2048                
  Moving Avg:         25                  Factor:             3                   
  Distil:             1                   Dropout:            0.1                 
  Embed:              timeF               Activation:         gelu                

[1mRun Parameters[0m
  Num Workers:        10                  Itr:                1                   
  Train Epochs:       10                  Batch Size:         128                 
  Patience:           3                   Learning Rate:      0.0001              
  Des:                Exp                 Loss:               MSE                 
  Lradj:              type1               Use Amp:            0                   

[1mGPU[0m
  Use GPU:            1                   GPU:                0                   
  Use Multi GPU:      1                   Devices:            0,1,2,3             

[1mDe-stationary Projector Params[0m
  P Hidden Dims:      128, 128            P Hidden Layers:    2                   

Use GPU: cuda:0
Traceback (most recent call last):
  File "/root/daye/AGPT/run.py", line 203, in <module>
    exp = Exp(args)  # set experiments
          ^^^^^^^^^
  File "/root/daye/AGPT/exp/exp_AGPT.py", line 22, in __init__
    super(Exp_AGPT, self).__init__(args)
  File "/root/daye/AGPT/exp/exp_basic.py", line 33, in __init__
    self.model = self._build_model().to(self.device)
                 ^^^^^^^^^^^^^^^^^^^
  File "/root/daye/AGPT/exp/exp_AGPT.py", line 28, in _build_model
    model = nn.DataParallel(model, device_ids=self.args.device_ids)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/Time/lib/python3.11/site-packages/torch/nn/parallel/data_parallel.py", line 159, in __init__
    _check_balance(self.device_ids)
  File "/root/anaconda3/envs/Time/lib/python3.11/site-packages/torch/nn/parallel/data_parallel.py", line 26, in _check_balance
    dev_props = _get_devices_properties(device_ids)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/Time/lib/python3.11/site-packages/torch/_utils.py", line 762, in _get_devices_properties
    return [_get_device_attr(lambda m: m.get_device_properties(i)) for i in device_ids]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/Time/lib/python3.11/site-packages/torch/_utils.py", line 762, in <listcomp>
    return [_get_device_attr(lambda m: m.get_device_properties(i)) for i in device_ids]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/Time/lib/python3.11/site-packages/torch/_utils.py", line 741, in _get_device_attr
    return get_member(torch.cuda)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/Time/lib/python3.11/site-packages/torch/_utils.py", line 762, in <lambda>
    return [_get_device_attr(lambda m: m.get_device_properties(i)) for i in device_ids]
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/Time/lib/python3.11/site-packages/torch/cuda/__init__.py", line 456, in get_device_properties
    raise AssertionError("Invalid device id")
AssertionError: Invalid device id
